<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>{% if eventdetails %}{{ eventdetails.eventname }} â€” Sahyog Sutra{% else %}Event Not Found â€” Sahyog Sutra{% endif %}</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/static/style.css">
<link rel="icon" type="image/png" href="/static/sahyog_sutra_logo.png">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text-color); -webkit-font-smoothing: antialiased; min-height: 100vh; }

/* â”€â”€ Navbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.navbar { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: rgba(10,10,14,0.92); backdrop-filter: blur(14px); border-bottom: 1px solid var(--border-color); padding: 0 3%; height: 56px; }
.nav-inner { display: flex; align-items: center; justify-content: space-between; height: 100%; }
.brand { display: flex; align-items: center; gap: 9px; text-decoration: none; }
.brand img { width: 32px; height: 32px; border-radius: 7px; object-fit: cover; box-shadow: 0 3px 10px rgba(215,106,30,0.3); }
.brand-text .b1 { font-size: 14px; font-weight: 700; background: linear-gradient(90deg,#f8ebb8,#d76a1e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.brand-text .b2 { font-size: 9.5px; color: var(--text-muted); }
.nav-right { display: flex; align-items: center; gap: 8px; }
.nav-eid { font-size: 0.7rem; color: var(--text-muted); padding: 3px 9px; border-radius: 5px; background: rgba(255,255,255,0.04); border: 1px solid var(--border-color); }
.nav-back { display: inline-flex; align-items: center; gap: 5px; text-decoration: none; color: var(--text-muted); font-size: 0.8rem; font-weight: 600; padding: 5px 12px; border-radius: 7px; border: 1px solid var(--border-color); transition: 0.18s; }
.nav-back:hover { color: var(--text-color); border-color: var(--primary-color); background: rgba(215,106,30,0.07); }
.nav-back svg { width: 13px; height: 13px; }

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toast { position: fixed; bottom: 1.5rem; left: 50%; transform: translateX(-50%) translateY(12px); z-index: 9999; display: flex; align-items: center; gap: 9px; padding: 10px 16px; border-radius: 9px; font-size: 0.84rem; font-weight: 600; min-width: 190px; max-width: 84vw; background: #1c1c26; border: 1px solid var(--border-color); color: var(--text-color); box-shadow: 0 8px 30px rgba(0,0,0,0.55); opacity: 0; pointer-events: none; transition: opacity 0.2s ease, transform 0.2s ease; }
.toast.show { opacity: 1; pointer-events: auto; transform: translateX(-50%) translateY(0); }
.toast.success { border-color: #22c55e; background: #0c2016; color: #4ade80; }
.toast.error   { border-color: #ef4444; background: #200c0c; color: #f87171; }
.toast.warning { border-color: #f59e0b; background: #1f1500; color: #fbbf24; }
.toast.info    { border-color: var(--primary-color); background: #1a0e04; color: var(--primary-color); }
.toast svg { width: 15px; height: 15px; flex-shrink: 0; }
.toast-x { background: none; border: none; color: inherit; opacity: 0.5; cursor: pointer; font-size: 1rem; line-height: 1; padding: 0 2px; margin-left: auto; transition: opacity 0.15s; }
.toast-x:hover { opacity: 1; }

/* â”€â”€ Page wrapper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page-wrap { padding: calc(1rem + 5vh) 3% 3%; display: flex; justify-content: center; }

/* â”€â”€ Main card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.event-card { width: 100%; max-width: 95vw; display: grid; grid-template-columns: clamp(300px, 40%, 450px) 1fr; border-radius: 1.4rem; border: 1px solid var(--border-color); overflow: hidden; background: var(--bg-light); box-shadow: 0 12px 40px rgba(0,0,0,0.35); }

/* â”€â”€ LEFT column â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ev-left { padding: clamp(0.75rem, 2%, 1.5rem); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; gap: clamp(0.5rem, 1%, 0.75rem); overflow-y: auto; max-height: 100vh; }

.ev-badge { display: inline-flex; align-items: center; gap: 0.35rem; padding: 0.2rem 0.75rem; border-radius: 20px; background: rgba(215,106,30,0.1); border: 1px solid rgba(215,106,30,0.26); font-size: clamp(0.5rem, 1vw, 0.64rem); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; color: var(--primary-color); width: fit-content; }
.ev-badge svg { width: clamp(7px, 1.5vw, 9px); height: clamp(7px, 1.5vw, 9px); }

.ev-title { font-size: clamp(1.1rem, 4vw, 1.35rem); font-weight: 800; line-height: 1.25; color: var(--text-color); }

.ev-sub { font-size: clamp(0.6rem, 1.5vw, 0.72rem); color: var(--text-muted); display: flex; align-items: center; gap: 0.4rem; flex-wrap: wrap; }
.ev-sub .dot { width: 0.2rem; height: 0.2rem; border-radius: 50%; background: var(--text-muted); flex-shrink: 0; }
.ev-sub a { color: var(--primary-color); font-weight: 700; text-decoration: none; }
.ev-sub a:hover { text-decoration: underline; }

/* pills */
.meta-row { display: flex; flex-wrap: wrap; gap: 0.4rem; }
.mpill { display: inline-flex; align-items: center; gap: 0.3rem; padding: clamp(0.25rem, 0.5%, 0.35rem) clamp(0.5rem, 1%, 0.65rem); border-radius: 0.5rem; background: var(--bg-dark); border: 1px solid var(--border-color); font-size: clamp(0.65rem, 1.2vw, 0.76rem); color: var(--text-muted); }
.mpill svg { width: clamp(9px, 1.2vw, 11px); height: clamp(9px, 1.2vw, 11px); flex-shrink: 0; color: var(--primary-color); }
.mpill strong, .mpill a { color: var(--text-color); font-weight: 600; text-decoration: none; }
.mpill a:hover { color: var(--primary-color); }

/* date row */
.date-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; }
.dc { background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 0.6rem; padding: clamp(0.5rem, 1%, 0.65rem) clamp(0.65rem, 1.2%, 0.85rem); }
.dc-lbl { font-size: clamp(0.5rem, 0.9vw, 0.59rem); text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-bottom: 0.2rem; display: flex; align-items: center; gap: 0.2rem; }
.dc-lbl svg { width: clamp(8px, 1vw, 9px); height: clamp(8px, 1vw, 9px); color: var(--primary-color); }
.dc-date { font-size: clamp(0.7rem, 1.2vw, 0.82rem); font-weight: 700; color: var(--text-color); }
.dc-time { font-size: clamp(0.6rem, 1vw, 0.7rem); color: var(--primary-color); font-weight: 600; margin-top: 0.1rem; }

/* location */
.loc-link { display: flex; align-items: center; gap: 0.6rem; padding: clamp(0.5rem, 1%, 0.65rem) clamp(0.65rem, 1.2%, 0.85rem); border-radius: 0.6rem; background: var(--bg-dark); border: 1px solid var(--border-color); text-decoration: none; color: var(--text-color); font-size: clamp(0.7rem, 1.2vw, 0.8rem); font-weight: 600; transition: 0.18s; overflow: hidden; }
.loc-link:hover { border-color: var(--primary-color); background: rgba(215,106,30,0.05); }
.loc-link svg { width: clamp(12px, 2vw, 14px); height: clamp(12px, 2vw, 14px); color: var(--primary-color); flex-shrink: 0; }
.loc-link span { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.loc-link .arr { color: var(--text-muted); font-size: clamp(0.65rem, 1vw, 0.78rem); flex-shrink: 0; }

/* divider */
.thin-div { height: 1px; background: var(--border-color); margin: 0.1rem 0; }

/* action buttons */
.act-row { display: flex; flex-wrap: wrap; gap: 0.4rem; }
.ab { display: inline-flex; align-items: center; gap: 0.3rem; background: var(--bg-dark); border: 1px solid var(--border-color); color: var(--text-muted); border-radius: 0.5rem; padding: clamp(0.3rem, 0.5%, 0.4rem) clamp(0.6rem, 1%, 0.75rem); font-size: clamp(0.65rem, 1vw, 0.75rem); font-weight: 600; cursor: pointer; transition: 0.15s; text-decoration: none; white-space: nowrap; }
.ab svg { width: clamp(11px, 1.5vw, 13px); height: clamp(11px, 1.5vw, 13px); flex-shrink: 0; }
.ab:hover { color: var(--primary-color); border-color: var(--primary-color); background: rgba(215,106,30,0.06); }
.ab.like svg { fill: none; stroke: currentColor; stroke-width: 2; }
.ab.like:hover, .ab.like.liked { color: #ef4444; border-color: #ef4444; background: rgba(239,68,68,0.07); }
.ab.like.liked svg { fill: #ef4444; stroke: #ef4444; }
.ab.del { color: #ef4444; border-color: rgba(239,68,68,0.28); background: rgba(239,68,68,0.05); }
.ab.del:hover { background: rgba(239,68,68,0.12); border-color: #ef4444; }
.ab.act-tr { color: var(--primary-color); border-color: var(--primary-color); background: rgba(215,106,30,0.09); }
@keyframes spin { to { transform: rotate(360deg); } }
.ab.loading svg { animation: spin 0.7s linear infinite; }

/* â”€â”€ Details Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sec-lbl { font-size: clamp(0.5rem, 0.9vw, 0.6rem); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; color: var(--text-muted); display: flex; align-items: center; gap: 0.5rem; }
.sec-lbl svg { width: clamp(9px, 1.2vw, 11px); height: clamp(9px, 1.2vw, 11px); color: var(--primary-color); }
.sec-lbl::after { content: ''; flex: 1; height: 1px; background: var(--border-color); }

.desc-text { font-size: clamp(0.75rem, 1.3vw, 0.88rem); line-height: 1.8; color: var(--text-muted); white-space: pre-wrap; }

/* info grid */
.igrid { display: grid; grid-template-columns: repeat(2, 1fr); gap: clamp(0.4rem, 1%, 0.5rem); }
.icell { background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 0.6rem; padding: clamp(0.5rem, 1%, 0.65rem) clamp(0.65rem, 1.2%, 0.8rem); }
.icell-lbl { font-size: clamp(0.5rem, 0.9vw, 0.57rem); text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-bottom: 0.3rem; display: flex; align-items: center; gap: 0.2rem; }
.icell-lbl svg { width: clamp(8px, 1vw, 9px); height: clamp(8px, 1vw, 9px); color: var(--primary-color); }
.icell-val { font-size: clamp(0.7rem, 1.1vw, 0.8rem); font-weight: 700; color: var(--text-color); }
.icell-val.orange { color: var(--primary-color); }
.icell-val.green  { color: #4ade80; }
.icell-val.red { color: #ef4444; }
.icell-val a { color: var(--primary-color); text-decoration: none; }
.icell-val a:hover { text-decoration: underline; }

/* divider light */
.thin-divider { display: flex; align-items: center; gap: 0.6rem; opacity: 0.25; }
.thin-divider::before, .thin-divider::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg,transparent,var(--accent-gold),transparent); }
.thin-divider span { font-size: clamp(0.5rem, 0.9vw, 0.56rem); letter-spacing: 2.5px; text-transform: uppercase; color: var(--accent-gold-light); white-space: nowrap; }

/* â”€â”€ RIGHT column (Chat Iframe) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ev-right { padding: 0; background: var(--bg-dark); border-left: 1px solid var(--border-color); }
.chat-iframe { width: 100%; height: 100%; border: none; display: block; min-height: clamp(60vh, 85vh, 100vh); }

/* â”€â”€ Error State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.error-state { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; text-align: center; padding: clamp(1rem, 3%, 2rem); }
.error-state svg { width: clamp(50px, 10vw, 64px); height: clamp(50px, 10vw, 64px); color: var(--primary-color); margin-bottom: clamp(0.75rem, 2%, 1rem); opacity: 0.7; }
.error-state h2 { font-size: clamp(1.2rem, 4vw, 1.5rem); font-weight: 700; margin-bottom: clamp(0.3rem, 1%, 0.5rem); color: var(--text-color); }
.error-state p { font-size: clamp(0.75rem, 2vw, 0.9rem); color: var(--text-muted); margin-bottom: clamp(1rem, 2%, 1.5rem); }
.error-state a { display: inline-flex; align-items: center; gap: 0.35rem; padding: clamp(0.5rem, 1%, 0.65rem) clamp(1rem, 2%, 1.2rem); background: rgba(215,106,30,0.1); border: 1px solid rgba(215,106,30,0.26); border-radius: 0.5rem; color: var(--primary-color); text-decoration: none; font-weight: 600; transition: 0.18s; }
.error-state a:hover { background: rgba(215,106,30,0.2); border-color: var(--primary-color); }

/* â”€â”€ Modals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.mbg { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2500; align-items: center; justify-content: center; backdrop-filter: blur(6px); }
.mbg.show { display: flex; }
.mbox { background: var(--bg-light); padding: clamp(1rem, 2%, 1.4rem); border-radius: 1rem; border: 1px solid var(--border-color); max-width: clamp(90vw, 85%, 340px); width: 92%; position: relative; box-shadow: 0 18px 50px rgba(0,0,0,0.5); }
.mclose { position: absolute; top: clamp(0.5rem, 1%, 0.7rem); right: clamp(0.5rem, 1%, 0.7rem); background: rgba(255,255,255,0.05); border: 1px solid var(--border-color); color: var(--text-muted); width: clamp(20px, 5vw, 24px); height: clamp(20px, 5vw, 24px); border-radius: 0.4rem; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: clamp(0.8rem, 1.5vw, 0.9rem); transition: 0.15s; }
.mclose:hover { color: var(--text-color); }
.mhead { text-align: center; margin-bottom: clamp(0.75rem, 1.5%, 1rem); }
.mhead svg { width: clamp(18px, 3vw, 22px); height: clamp(18px, 3vw, 22px); color: var(--primary-color); margin-bottom: 0.4rem; }
.mhead h3 { font-size: clamp(0.8rem, 2vw, 0.95rem); font-weight: 700; }
.mhead p { font-size: clamp(0.6rem, 1.2vw, 0.75rem); color: var(--text-muted); margin-top: 0.15rem; }
.mopts { display: grid; gap: clamp(0.4rem, 0.8%, 0.5rem); }
.mopt { display: flex; align-items: center; gap: 0.75rem; width: 100%; padding: clamp(0.6rem, 1%, 0.75rem) clamp(0.8rem, 1.5%, 1rem); background: var(--bg-dark); border: 1px solid var(--border-color); color: var(--text-color); border-radius: 0.6rem; cursor: pointer; transition: 0.15s; font-size: clamp(0.75rem, 1.2vw, 0.84rem); font-weight: 600; text-decoration: none; }
.mopt:hover { border-color: var(--primary-color); background: rgba(215,106,30,0.07); }
.mopt svg { width: clamp(14px, 2vw, 16px); height: clamp(14px, 2vw, 16px); flex-shrink: 0; }
.mopt.wa { color: #22c55e; }
.mopt.wa:hover { border-color: #22c55e; background: rgba(34,197,94,0.07); }

/* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 780px) {
  .event-card { grid-template-columns: 1fr; max-width: 95vw; }
  .ev-left { border-right: none; border-bottom: 1px solid var(--border-color); max-height: none; }
  .ev-right { display: none; }
}
@media (max-width: 500px) {
  .page-wrap { padding: calc(1rem + 4vh) 3% 3%; }
  .event-card { max-width: 100%; border-radius: 0.8rem; }
  .ev-left { padding: clamp(0.7rem, 2%, 1rem); }
  .igrid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<!-- Navbar -->
<header class="navbar">
  <div class="nav-inner">
    <a href="/" class="brand">
      <img src="/static/sahyog_sutra_logo.png" alt="Sahyog Sutra">
      <div class="brand-text">
        <div class="b1">{{ translate("Sahyog Sutra") }}</div>
        <div class="b2">{{ translate("Weaving Communities Together") }}</div>
      </div>
    </a>

  </div>
</header>

<!-- Toast -->
<div id="toast" class="toast" role="alert" aria-live="polite">
  <svg id="toast-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"></svg>
  <span id="toast-text"></span>
  <button class="toast-x" onclick="hideToast()">Ã—</button>
</div>

<!-- Page -->
<div class="page-wrap">
  {% if eventdetails %}
    <!-- Event Found - Show Content -->
    <div class="event-card">

      <!-- â•â• LEFT PANEL (Combined Details) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="ev-left">

        <!-- Badge & Title -->
        <div class="ev-badge">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
          {{ translate("Event") }} Â· {{ eventdetails.category }}
        </div>

        <h1 class="ev-title">{{ eventdetails.eventname }}</h1>

        <div class="ev-sub">
          <span>{{ translate("by") }}</span><span class="dot"></span>
          <a href="/user/{{ eventdetails.username }}">{{ eventdetails.username }}</a>
          <span class="dot"></span><span>#{{ eventdetails.eventid }}</span>
        </div>

        <!-- Meta Info -->
        <div class="meta-row">
          <div class="mpill">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
            <span id="like-pill">{{ eventdetails.likes or 0 }}</span>&thinsp;{{ translate("likes") }}
          </div>
          <div class="mpill">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/></svg>
            <strong>{{ eventdetails.category }}</strong>
          </div>
          <div class="mpill">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
            <a href="/user/{{ eventdetails.username }}">{{ eventdetails.username }}</a>
          </div>
        </div>

        <!-- Date & Time -->
        <div class="date-row">
          <div class="dc">
            <div class="dc-lbl">
              <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
              {{ translate("Starts") }}
            </div>
            <div class="dc-date">{{ eventdetails.eventstartdate | datetimeformat }}</div>
            <div class="dc-time">â° {{ eventdetails.eventstarttime }}</div>
          </div>
          <div class="dc">
            <div class="dc-lbl">
              <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              {{ translate("Ends") }}
            </div>
            <div class="dc-date">{{ eventdetails.eventenddate | datetimeformat }}</div>
            <div class="dc-time">ğŸ {{ eventdetails.eventendtime }}</div>
          </div>
        </div>

        <!-- Location -->
        <a href="https://www.google.com/maps/search/?api=1&query={{ eventdetails.location | urlencode }}" target="_blank" class="loc-link">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
          <span>{{ eventdetails.location }}</span>
          <span class="arr">â†—</span>
        </a>

        <div class="thin-div"></div>

        <!-- Action Buttons -->
        <div class="act-row">

          <!-- Like Button -->
          {% if c_user == "None" %}
            {% set loginalertmsg = translate("Login to like this event.") %}
            <button id="likeevent-{{ eventdetails.eventid }}" class="ab like" onclick="showAlert('{{ loginalertmsg }}', 'warning')">
              <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
              <span id="eventlike-{{ eventdetails.eventid }}">{{ eventdetails.likes or 0 }}</span>
            </button>
          {% else %}
            {% set userliked = userdetails['likes'].split(",") if userdetails and userdetails['likes'] else [] %}
            {% if eventdetails.eventid|string in userliked %}
              <button id="likeevent-{{ eventdetails.eventid }}" class="ab like liked" onclick="changelike({{ eventdetails.eventid }},'remove')">
                <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                <span id="eventlike-{{ eventdetails.eventid }}">{{ eventdetails.likes or 0 }}</span>
              </button>
            {% else %}
              <button id="likeevent-{{ eventdetails.eventid }}" class="ab like" onclick="changelike({{ eventdetails.eventid }},'add')">
                <svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                <span id="eventlike-{{ eventdetails.eventid }}">{{ eventdetails.likes or 0 }}</span>
              </button>
            {% endif %}
          {% endif %}

          <button class="ab" onclick="openM('shareModal')">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
            {{ translate("Share") }}
          </button>

          <a href="/download_ics/{{ eventdetails.eventid }}" class="ab">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
            {{ translate("Calendar") }}
          </a>

          <a href="/group-chat/from-event/{{ eventdetails.eventid }}" class="ab">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
            {{ translate("Chat") }}
          </a>

          <a href="/user/{{ eventdetails.username }}" class="ab">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
            {{ translate("Profile") }}
          </a>

          {% if user_lang != "en" %}
          <button class="ab" id="translateBtn" onclick="toggleTranslate(this)">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
            {{ translate("Translate") }}
          </button>
          {% endif %}

          {% if eventdetails.username == c_user or isadmin %}
          <button class="ab del" onclick="openM('deleteModal')">
            <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 01-2 2H8a2 2 0 01-2-2L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
            {{ translate("Delete") }}
          </button>
          {% endif %}

        </div>

        <div class="thin-div"></div>

        <!-- Description Section -->
        <div class="sec-lbl">
          <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
          {{ translate("Full Description") }}
        </div>

        <p class="desc-text" id="desc-main">{{ eventdetails.description }}</p>

        <div class="thin-divider"><span>{{ translate("Details") }}</span></div>

        <!-- Info Grid -->
        <div class="igrid">
          <div class="icell">
            <div class="icell-lbl">
              <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/></svg>
              {{ translate("Category") }}
            </div>
            <div class="icell-val orange">{{ eventdetails.category }}</div>
          </div>
          <div class="icell">
            <div class="icell-lbl">
              <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              {{ translate("Status") }}
            </div>
            <div id="event-status" class="icell-val green">â— {{ translate("Active") }}</div>
          </div>
          <div class="icell">
            <div class="icell-lbl">
              <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
              {{ translate("Posted By") }}
            </div>
            <div class="icell-val"><a href="/user/{{ eventdetails.username }}">{{ eventdetails.username }}</a></div>
          </div>
          <div class="icell">
            <div class="icell-lbl">
              <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
              {{ translate("Total Likes") }}
            </div>
            <div class="icell-val" id="eventlike-grid">{{ eventdetails.likes or 0 }}</div>
          </div>
        </div>

      </div>

      <!-- â•â• RIGHT PANEL (Group Chat Iframe) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="ev-right">
        <iframe src="/group-chat/from-event/{{ eventdetails.eventid }}" class="chat-iframe"></iframe>
      </div>

    </div>
  {% else %}
    <!-- Event Not Found - Show Error State -->
    <div class="error-state">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <h2>{{ translate("Event Not Found") }}</h2>
      <p>{{ translate("The event you're looking for doesn't exist or has been removed.") }}</p>
      <a href="/">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18"/></svg>
        {{ translate("Back to Home") }}
      </a>
    </div>
  {% endif %}
</div>

<!-- â”€â”€ Share Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="shareModal" class="mbg">
  <div class="mbox">
    <button class="mclose" onclick="closeM('shareModal')">Ã—</button>
    <div class="mhead">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
      <h3>{{ translate("Share") }}</h3>
      <p id="share-event-name">{{ eventdetails.eventname if eventdetails else "" }}</p>
    </div>
    <div class="mopts">
      <button class="mopt wa" onclick="shareWA()">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
        {{ translate("Share on WhatsApp") }}
      </button>
      <button class="mopt" onclick="copyLink()">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
        {{ translate("Copy Link") }}
      </button>
      {% if eventdetails %}
      <a href="/download_ics/{{ eventdetails.eventid }}" class="mopt" onclick="closeM('shareModal')">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        {{ translate("Add to Calendar (.ics)") }}
      </a>
      {% endif %}
    </div>
  </div>
</div>

<!-- â”€â”€ Delete Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
{% if eventdetails %}
<div id="deleteModal" class="mbg">
  <div class="mbox" style="max-width:300px;">
    <button class="mclose" onclick="closeM('deleteModal')">Ã—</button>
    <div class="mhead">
      <svg style="color:#ef4444;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
      <h3 style="color:#f87171;">{{ translate("Delete Event?") }}</h3>
      <p>{{ translate("This cannot be undone.") }}</p>
    </div>
    <div style="display:flex;gap:7px;">
      <button onclick="closeM('deleteModal')" class="ab" style="flex:1;justify-content:center;padding:8px 0;">{{ translate("Cancel") }}</button>
      <a href="/deleteevent/{{ eventdetails.eventid }}" class="ab del" style="flex:1;justify-content:center;padding:8px 0;">{{ translate("Delete") }}</a>
    </div>
  </div>
</div>
{% endif %}

<script>
const socket = io();
{% if eventdetails %}
const EVENTID = {{ eventdetails.eventid }};
const EVENTNAME = {{ eventdetails.eventname | tojson }};
const EVENTLOC  = {{ eventdetails.location | tojson }};
const EVENTDATE = {{ (eventdetails.eventstartdate | datetimeformat) | tojson }};
const EVENTTIME = {{ eventdetails.eventstarttime | tojson }};
const EVENTSTARTDATETIME = {{ eventdetails.eventstartdate | tojson }};
const EVENTENDDATETIME = {{ eventdetails.eventenddate | tojson }};
const ORIG_DESC = {{ eventdetails.description | tojson }};
const C_USER    = "{{ c_user }}";
{% else %}
const EVENTID = null;
const C_USER = "{{ c_user }}";
{% endif %}
let translated  = false;

/* Toast */
const TI = {
  success: '<path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>',
  error:   '<path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>',
  warning: '<path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>',
  info:    '<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>'
};
let tmr;

function showAlert(msg, type='info') {
  const t = document.getElementById('toast');
  document.getElementById('toast-icon').innerHTML = TI[type]||TI.info;
  document.getElementById('toast-text').textContent = msg;
  t.className = 'toast '+type+' show';
  clearTimeout(tmr);
  tmr = setTimeout(hideToast, 3600);
}

function hideToast() {
  document.getElementById('toast').classList.remove('show');
}

/* Modals */
function openM(id)  {
  document.getElementById(id).classList.add('show');
}

function closeM(id) {
  document.getElementById(id).classList.remove('show');
}

document.querySelectorAll('.mbg').forEach(m => m.addEventListener('click', e => {
  if(e.target===m) m.classList.remove('show');
}));

/* Event Status Checker */
function updateEventStatus() {
  if (!EVENTID) return;

  try {
    const startStr = EVENTSTARTDATETIME;
    const endStr = EVENTENDDATETIME;

    // Parse start date-time (format: "2024-01-15 14:30:00" or "2024-01-15")
    let startDateTime;
    if (startStr.includes(' ')) {
      const [startDate, startTime] = startStr.split(' ');
      startDateTime = new Date(startDate + 'T' + startTime);
    } else {
      startDateTime = new Date(startStr + 'T00:00:00');
    }

    // Parse end date (format: "2024-01-15" - just date, no time)
    // Set end time to 23:59:59 to include the entire day
    let endDateTime;
    if (endStr.includes(' ')) {
      const [endDate, endTime] = endStr.split(' ');
      endDateTime = new Date(endDate + 'T' + endTime);
    } else {
      endDateTime = new Date(endStr + 'T23:59:59');
    }

    const currentTime = new Date();

    const statusEl = document.getElementById('event-status');
    let statusHTML = '';

    if (currentTime < startDateTime) {
      // Upcoming
      statusHTML = 'â³ {{ translate("Upcoming") }}';
      if (statusEl) statusEl.className = 'icell-val orange';
    } else if (currentTime >= startDateTime && currentTime <= endDateTime) {
      // Ongoing
      statusHTML = 'ğŸŸ¢ {{ translate("Ongoing") }}';
      if (statusEl) statusEl.className = 'icell-val green';
    } else {
      // Ended
      statusHTML = 'âœ“ {{ translate("Ended") }}';
      if (statusEl) statusEl.className = 'icell-val red';
    }

    if (statusEl) statusEl.innerHTML = statusHTML;
  } catch (e) {
    console.error('Error updating event status:', e);
  }
}

// Update status on load and every minute
if (EVENTID) {
  updateEventStatus();
  setInterval(updateEventStatus, 60000);
}

/* Like */
function allLikeEls() {
  return document.querySelectorAll('#eventlike-'+EVENTID+', #like-pill, #eventlike-grid');
}

function changelike(id, type) {
  const btn = document.getElementById('likeevent-'+id);
  allLikeEls().forEach(el => {
    let n=parseInt(el.innerText)||0;
    el.innerText=type==='add'?n+1:Math.max(0,n-1);
  });
  if(type==='add') {
    btn.classList.add('liked');
    btn.setAttribute('onclick',`changelike(${id},'remove')`);
  }
  else {
    btn.classList.remove('liked');
    btn.setAttribute('onclick',`changelike(${id},'add')`);
  }
  socket.emit('addeventlike',{eventid:id,byuser:C_USER,type});
}

socket.on('update_like', d => {
  if(d.eventid==EVENTID) allLikeEls().forEach(el=>el.innerText=d.likes);
});

/* Share */
function shareWA() {
  if (!EVENTID) return;
  const link=`${location.origin}/event/${EVENTID}`;
  window.open('https://wa.me/?text='+encodeURIComponent(`*${EVENTNAME}*\nğŸ“… ${EVENTDATE} at ${EVENTTIME}\nğŸ“ ${EVENTLOC}\n\nğŸ”— ${link}`),'_blank');
  closeM('shareModal');
}

function copyLink() {
  if (!EVENTID) return;
  const link=`${location.origin}/event/${EVENTID}`;
  const fb=()=>{
    const ta=document.createElement('textarea');
    ta.value=link;
    ta.style.cssText='position:fixed;left:-9999px';
    document.body.appendChild(ta);
    ta.select();
    try{
      document.execCommand('copy');
      showAlert('{{ translate("Copied!") }}','success');
    } catch {
      showAlert('{{ translate("Failed") }}','error');
    }
    document.body.removeChild(ta);
  };
  navigator.clipboard && window.isSecureContext ? navigator.clipboard.writeText(link).then(()=>showAlert('{{ translate("Copied!") }}','success')).catch(fb) : fb();
  closeM('shareModal');
}

/* Translate */
function toggleTranslate(btn) {
  if (!EVENTID) return;
  const d=document.getElementById('desc-main');
  if(translated){
    d.textContent=ORIG_DESC;
    btn.classList.remove('act-tr','loading');
    translated=false;
    return;
  }
  btn.classList.add('loading','act-tr');
  fetch('/api/translate',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({text:ORIG_DESC})
  })
    .then(r=>r.json())
    .then(res=>{
      d.textContent=res.translated||ORIG_DESC;
      translated=true;
      btn.classList.remove('loading');
    })
    .catch(()=>{
      btn.classList.remove('loading','act-tr');
      showAlert('{{ translate("Translation failed.") }}','error');
    });
}
</script>
</body>
</html>
